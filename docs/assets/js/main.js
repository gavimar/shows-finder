"use strict";const inputSearch=document.querySelector("#show_search"),submitButton=document.querySelector("#submit"),ulElement=document.querySelector("#search-list"),ulFavouriteElement=document.querySelector("#favourites-list");inputSearch.addEventListener("keyup",(function(e){13===e.keyCode&&(e.preventDefault(),document.getElementById("submit").click())}));let showList=null,favourites=readLocalStorage();function connectToApi(){ulElement.innerHTML="",fetch(`http://api.tvmaze.com/search/shows?q=${inputSearch.value}`).then(e=>e.json()).then(e=>{showList=e,renderShows(showList),console.log(showList)})}function renderShows(e){for(let t of e){const e=document.createElement("li");e.setAttribute("id",`${t.show.id}`),e.setAttribute("class","liElement");let o=document.createTextNode(t.show.name),n=document.createElement("h2");n.appendChild(o),e.appendChild(n),ulElement.appendChild(e);let i=document.createElement("img");null!==t.show.image?(i.src=t.show.image.medium,e.appendChild(i)):(i.src="https://via.placeholder.com/210x295/ffffff/666666/?text=TV",e.appendChild(i))}addClickListeners()}function addClickListeners(){const e=document.querySelectorAll(".liElement");for(let t of e)t.addEventListener("click",saveFavourites)}function saveFavourites(e){e.currentTarget.classList.toggle("selected");const t=e.currentTarget.id,o=getObject(t);favourites.some(e=>e.id===parseInt(t))?alert("ya esta en favoritos"):(favourites.push(o.show),setLocalStorage(favourites),renderFavourites(favourites),console.log(favourites))}function getObject(e){return showList.find(t=>t.show.id===parseInt(e))}function setLocalStorage(e){localStorage.setItem("favourites",JSON.stringify(e))}function readLocalStorage(){let e=JSON.parse(localStorage.getItem("favourites"));return null!==e?e:[]}function renderFavourites(e){ulFavouriteElement.innerHTML="";for(let t of e)if(t){const e=document.createElement("li");e.setAttribute("class","liFavourite"),e.setAttribute("id",`${t.id}`);let o=document.createTextNode(t.name),n=document.createElement("p");n.appendChild(o),e.appendChild(n),ulFavouriteElement.appendChild(e);let i=document.createElement("i");i.setAttribute("class","fa fa-window-close"),i.setAttribute("aria-hidden","true"),e.appendChild(i);let r=document.createElement("img");null!==t.image.medium?(r.src=t.image.medium,e.appendChild(r)):(r.src="https://via.placeholder.com/50x100/ffffff/666666/?text=TV",e.appendChild(r))}addFavouriteListeners()}function addFavouriteListeners(){const e=document.querySelectorAll("i");for(let t of e)t.addEventListener("click",removeFav)}function removeFav(e){const t=e.target.parentElement.getAttribute("id"),o=favourites.find(e=>e.id===Number(t));let n=favourites.indexOf(o);favourites.splice(n,1),setLocalStorage(),renderFavourites(favourites)}submitButton.addEventListener("click",connectToApi),renderFavourites(favourites);